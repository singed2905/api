<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Geometry Mode - Demo Client</title>
  <style>
    :root { --bg:#0f172a; --fg:#e2e8f0; --muted:#94a3b8; --card:#111827; --accent:#22d3ee; --ok:#22c55e; --err:#ef4444; }
    *{box-sizing:border-box} body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background: var(--bg); color: var(--fg); margin: 0; }
    header { padding: 20px 24px; border-bottom: 1px solid #1f2937; display:flex; align-items:center; gap:16px; }
    header h1 { font-size: 18px; margin: 0; }
    main { padding: 24px; display:grid; grid-template-columns: 360px 1fr; gap: 24px; }
    .panel { background: var(--card); border: 1px solid #1f2937; border-radius: 12px; padding: 16px; }
    .panel h2 { font-size: 14px; margin: 0 0 12px; color: var(--muted); letter-spacing: .08em; text-transform: uppercase; }
    label { display:block; font-size: 13px; color: var(--muted); margin: 12px 0 6px; }
    select, input[type="text"] { width:100%; padding:10px 12px; background:#0b1220; color:var(--fg); border:1px solid #1f2937; border-radius:8px; outline:none; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .chip { display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border:1px solid #1f2937; border-radius:999px; font-size:12px; color:var(--muted); }
    .btn { background: linear-gradient(135deg, #06b6d4, #22d3ee); color:#001219; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600; }
    .btn.secondary { background:#0b1220; color:var(--fg); border:1px solid #1f2937; }
    .actions { display:flex; gap:10px; margin-top: 14px; }
    .kpi { display:grid; grid-template-columns: repeat(3,1fr); gap:12px; margin-top:16px; }
    .kpi .box{ background:#0b1220; border:1px solid #1f2937; padding:10px 12px; border-radius:10px; }
    .kpi .box .t{ font-size:11px; color:var(--muted)} .kpi .box .v{ font-size:16px; margin-top:4px}
    pre { background:#0b1220; color:#e5e7eb; padding:12px; border-radius:10px; border:1px solid #1f2937; overflow:auto; max-height:360px; }
    .ok{color:var(--ok)} .err{color:var(--err)}
    footer{ padding:16px 24px; border-top:1px solid #1f2937; color:var(--muted); font-size:12px }
    @media (max-width: 960px){ main{ grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <header>
    <div class="chip">üìê Geometry Mode</div>
    <h1>Demo nh·∫≠p d·ªØ li·ªáu & g·ªçi API</h1>
    <div style="margin-left:auto" class="chip" id="status">‚óè Offline</div>
  </header>

  <main>
    <section class="panel" id="formPanel">
      <h2>Th√¥ng tin ph√©p to√°n</h2>
      <label>Ph√©p to√°n</label>
      <select id="operation">
        <option value="Kho·∫£ng c√°ch">Kho·∫£ng c√°ch</option>
        <option value="T∆∞∆°ng giao">T∆∞∆°ng giao</option>
        <option value="Di·ªán t√≠ch">Di·ªán t√≠ch</option>
        <option value="Th·ªÉ t√≠ch">Th·ªÉ t√≠ch</option>
      </select>

      <div class="row">
        <div>
          <label>H√¨nh A</label>
          <select id="shapeA">
            <option>ƒêi·ªÉm</option>
            <option>ƒê∆∞·ªùng th·∫≥ng</option>
            <option>M·∫∑t ph·∫≥ng</option>
            <option>ƒê∆∞·ªùng tr√≤n</option>
            <option>M·∫∑t c·∫ßu</option>
          </select>
        </div>
        <div>
          <label>H√¨nh B (tu·ª≥ ch·ªçn)</label>
          <select id="shapeB">
            <option value="">‚Äî Kh√¥ng ‚Äî</option>
            <option>ƒêi·ªÉm</option>
            <option>ƒê∆∞·ªùng th·∫≥ng</option>
            <option>M·∫∑t ph·∫≥ng</option>
            <option>ƒê∆∞·ªùng tr√≤n</option>
            <option>M·∫∑t c·∫ßu</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Chi·ªÅu A</label>
          <select id="dimA">
            <option value="3">3</option>
            <option value="2">2</option>
          </select>
        </div>
        <div>
          <label>Chi·ªÅu B</label>
          <select id="dimB">
            <option value="">‚Äî</option>
            <option value="3">3</option>
            <option value="2">2</option>
          </select>
        </div>
      </div>

      <label>M√°y t√≠nh</label>
      <select id="version">
        <option value="fx799">fx799</option>
        <option value="fx880">fx880</option>
        <option value="fx991">fx991</option>
        <option value="fx570">fx570</option>
      </select>

      <h2 style="margin-top:18px">D·ªØ li·ªáu h√¨nh h·ªçc</h2>

      <div id="inputsA">
        <label>ƒêi·ªÉm A (x,y,z ho·∫∑c x,y)</label>
        <input type="text" id="pointA" placeholder="V√≠ d·ª•: 1,2,3" />

        <div class="row">
          <div>
            <label>ƒêi·ªÉm thu·ªôc ƒêT A (x,y,z)</label>
            <input type="text" id="lineAP" placeholder="V√≠ d·ª•: 1,2,3" />
          </div>
          <div>
            <label>Vector ch·ªâ ph∆∞∆°ng A (x,y,z)</label>
            <input type="text" id="lineAV" placeholder="V√≠ d·ª•: 1,0,1" />
          </div>
        </div>

        <div class="row">
          <div><label>MP A - a</label><input type="text" id="planeAa" placeholder="1" /></div>
          <div><label>MP A - b</label><input type="text" id="planeAb" placeholder="2" /></div>
        </div>
        <div class="row">
          <div><label>MP A - c</label><input type="text" id="planeAc" placeholder="3" /></div>
          <div><label>MP A - d</label><input type="text" id="planeAd" placeholder="4" /></div>
        </div>

        <div class="row">
          <div><label>T√¢m tr√≤n A (x,y)</label><input type="text" id="circleAI" placeholder="0,0" /></div>
          <div><label>B√°n k√≠nh A</label><input type="text" id="circleAR" placeholder="5" /></div>
        </div>

        <div class="row">
          <div><label>T√¢m c·∫ßu A (x,y,z)</label><input type="text" id="sphereAI" placeholder="0,0,0" /></div>
          <div><label>B√°n k√≠nh A</label><input type="text" id="sphereAR" placeholder="3" /></div>
        </div>
      </div>

      <div id="inputsB" style="margin-top:8px">
        <label>ƒêi·ªÉm B (x,y,z ho·∫∑c x,y)</label>
        <input type="text" id="pointB" placeholder="V√≠ d·ª•: 4,5,6" />

        <div class="row">
          <div>
            <label>ƒêi·ªÉm thu·ªôc ƒêT B (x,y,z)</label>
            <input type="text" id="lineBP" placeholder="V√≠ d·ª•: 0,1,2" />
          </div>
          <div>
            <label>Vector ch·ªâ ph∆∞∆°ng B (x,y,z)</label>
            <input type="text" id="lineBV" placeholder="V√≠ d·ª•: 0,1,0" />
          </div>
        </div>

        <div class="row">
          <div><label>MP B - a</label><input type="text" id="planeBa" placeholder="1" /></div>
          <div><label>MP B - b</label><input type="text" id="planeBb" placeholder="2" /></div>
        </div>
        <div class="row">
          <div><label>MP B - c</label><input type="text" id="planeBc" placeholder="3" /></div>
          <div><label>MP B - d</label><input type="text" id="planeBd" placeholder="4" /></div>
        </div>

        <div class="row">
          <div><label>T√¢m tr√≤n B (x,y)</label><input type="text" id="circleBI" placeholder="0,0" /></div>
          <div><label>B√°n k√≠nh B</label><input type="text" id="circleBR" placeholder="5" /></div>
        </div>

        <div class="row">
          <div><label>T√¢m c·∫ßu B (x,y,z)</label><input type="text" id="sphereBI" placeholder="0,0,0" /></div>
          <div><label>B√°n k√≠nh B</label><input type="text" id="sphereBR" placeholder="3" /></div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="btnSend">G·ªçi API</button>
        <button class="btn secondary" id="btnFill">ƒêi·ªÅn v√≠ d·ª•</button>
        <button class="btn secondary" id="btnClear">Xo√°</button>
      </div>

      <div class="kpi">
        <div class="box"><div class="t">Th·ªùi gian</div><div class="v" id="kpiTime">-</div></div>
        <div class="box"><div class="t">Tr·∫°ng th√°i</div><div class="v" id="kpiStatus">-</div></div>
        <div class="box"><div class="t">Phi√™n b·∫£n</div><div class="v" id="kpiVer">-</div></div>
      </div>
    </section>

    <section class="panel">
      <h2>K·∫øt qu·∫£</h2>
      <label>Keylog</label>
      <pre id="keylog">(ch∆∞a c√≥)</pre>
      <label>Raw Response</label>
      <pre id="resp">(ch∆∞a c√≥)</pre>
    </section>
  </main>

  <footer>
    Demo client cho Geometry Mode ‚Ä¢ K·∫øt n·ªëi t·ªõi API FastAPI t·∫°i <code id="baseUrl">http://localhost:8000</code>
  </footer>

  <script>
    const BASE = location.origin.includes('localhost') ? 'http://localhost:8000' : location.origin
    const $ = (id)=>document.getElementById(id);
    $('baseUrl').textContent = BASE;

    async function ping() {
      try {
        const rs = await fetch(`${BASE}/health`);
        $('status').textContent = rs.ok ? '‚óè Online' : '‚óè Offline';
        $('status').style.color = rs.ok ? 'var(--ok)': 'var(--err)';
      } catch(e){ $('status').textContent = '‚óè Offline'; $('status').style.color='var(--err)'; }
    }
    ping();

    function buildPayload(){
      const op = $('operation').value;
      const shapeA = $('shapeA').value; const shapeB = $('shapeB').value || null;
      const dimA = $('dimA').value; const dimB = $('dimB').value || null;
      const ver = $('version').value;

      const payload = {
        operation: op,
        shape_a: shapeA,
        shape_b: shapeB,
        dimension_a: dimA,
        dimension_b: dimB,
        calculator_version: ver,
        include_raw_calculation: true
      };
      // A
      if (shapeA === 'ƒêi·ªÉm' && $('pointA').value) payload.point_a = {coordinates: $('pointA').value};
      if (shapeA === 'ƒê∆∞·ªùng th·∫≥ng' && ($('lineAP').value || $('lineAV').value)) payload.line_a = {point: $('lineAP').value, direction_vector: $('lineAV').value};
      if (shapeA === 'M·∫∑t ph·∫≥ng' && ($('planeAa').value||$('planeAb').value||$('planeAc').value||$('planeAd').value)) payload.plane_a = {a:$('planeAa').value,b:$('planeAb').value,c:$('planeAc').value,d:$('planeAd').value};
      if (shapeA === 'ƒê∆∞·ªùng tr√≤n' && ($('circleAI').value||$('circleAR').value)) payload.circle_a = {center:$('circleAI').value, radius:$('circleAR').value};
      if (shapeA === 'M·∫∑t c·∫ßu' && ($('sphereAI').value||$('sphereAR').value)) payload.sphere_a = {center:$('sphereAI').value, radius:$('sphereAR').value};
      // B
      if (shapeB){
        if (shapeB === 'ƒêi·ªÉm' && $('pointB').value) payload.point_b = {coordinates: $('pointB').value};
        if (shapeB === 'ƒê∆∞·ªùng th·∫≥ng' && ($('lineBP').value || $('lineBV').value)) payload.line_b = {point: $('lineBP').value, direction_vector: $('lineBV').value};
        if (shapeB === 'M·∫∑t ph·∫≥ng' && ($('planeBa').value||$('planeBb').value||$('planeBc').value||$('planeBd').value)) payload.plane_b = {a:$('planeBa').value,b:$('planeBb').value,c:$('planeBc').value,d:$('planeBd').value};
        if (shapeB === 'ƒê∆∞·ªùng tr√≤n' && ($('circleBI').value||$('circleBR').value)) payload.circle_b = {center:$('circleBI').value, radius:$('circleBR').value};
        if (shapeB === 'M·∫∑t c·∫ßu' && ($('sphereBI').value||$('sphereBR').value)) payload.sphere_b = {center:$('sphereBI').value, radius:$('sphereBR').value};
      }
      return payload;
    }

    $('btnFill').onclick = ()=>{
      $('operation').value = 'Kho·∫£ng c√°ch';
      $('shapeA').value = 'ƒêi·ªÉm';
      $('shapeB').value = 'ƒêi·ªÉm';
      $('dimA').value = '3'; $('dimB').value = '3';
      $('version').value = 'fx799';
      $('pointA').value = '1,2,3';
      $('pointB').value = '4,5,6';
    };

    $('btnClear').onclick = ()=>{
      document.querySelectorAll('input').forEach(i=>i.value='');
      $('keylog').textContent = '(ch∆∞a c√≥)';
      $('resp').textContent = '(ch∆∞a c√≥)';
      $('kpiTime').textContent = '-';
      $('kpiStatus').textContent = '-';
      $('kpiVer').textContent = '-';
    };

    $('btnSend').onclick = async()=>{
      const payload = buildPayload();
      const t0 = performance.now();
      $('kpiStatus').textContent = 'Sending...';
      try{
        const rs = await fetch(`${BASE}/api/v1/geometry/calculate`,{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
        const t1 = performance.now();
        const data = await rs.json();
        $('keylog').textContent = data.encoded_keylog || '(no keylog)';
        $('resp').textContent = JSON.stringify(data,null,2);
        $('kpiTime').textContent = (t1 - t0).toFixed(1)+' ms';
        $('kpiStatus').innerHTML = rs.ok ? '<span class="ok">OK</span>' : '<span class="err">Error</span>';
        $('kpiVer').textContent = data.calculator_version || '-';
      }catch(e){
        $('resp').textContent = String(e);
        $('kpiStatus').innerHTML = '<span class="err">Network</span>';
      }
    };
  </script>
</body>
</html>
